---
layout: post
title: intro splash 속도 개선 (8초에서 2초로..)
date: 2022-06-10 01:01:01
categories: [리팩토링, 성능개선]
project: STEPS
---

splash 화면의 속도를 약 8초에서 2초까지 줄였다.  

테스트폰에서 STEPS 4.0 splash 화면은 1.5~2초 정도로 굉장히 양호한 상태이다.  
그러나 개인폰에서는 약 8초라는 미친? 시간이 걸렸는데도, 그냥 내 폰 인터넷 문제겠거니.. 하고 넘어가곤 했다.  
주변에서도 splash가 느리다는 이야기가 조금씩 나와도 급한 운영건 쳐내기 바빠 넘기곤 했었는데....... 한번 파보자 결심했다.  

크게 '해외 마켓 코드', '종목 마스터', '공지사항', '암호화키', '로그인' 등의 전문들을 호출하는데,  
이 전문들 모두 코루틴 비동기 병렬 처리되어 잘 동작하고 있었다.  
짧은 건 약 400ms, 긴 건 약 1600ms 정도로 완료되었다.  
전문 통신의 문제라 생각했지만, 문제는 따로 있었다.  

보안을 위한 폰 체크 및 앱 스캔 기능에서 약 8초라는 시간이 걸렸다.  
앱이 많이 깔려있지 않은 테스트폰에서는 약 2초 안으로 splash가 끝나는 반면, 내 개인폰에서는 8초라는 시간이 걸리게 된 문제가 여기 있었다.  

### 이슈 체크
- 전문들은 모두 비동기 병렬 처리되고 있고, 속도도 양호한 편. 더 뺄 것은 없어보임.  
- 많은 앱이 설치되어 있는 폰에서 보안을 위한 폰 체크 및 앱 스캔 기능의 시간이 약 8초나 걸림.  

### 비교 분석
- 키X : '악성코드를 발견했습니다.' 푸시만 뜨고 정상 사용 가능.  
- 토X : '닫기', '악성앱삭제' 버튼 나옴. '닫기' 누르고 정상 사용 가능.  
- 카X : '카X 앱은 전자금융거래사고 방지를 위해 기기에 설치된 위협정보를 수집할 수 있습니다.' 알림 뜨고, '동의하고시작' 버튼 나옴. 이후 탐지되면 '취소', '제거' 버튼 나옴. '취소' 누르고 정상 사용 가능.

### 개선 방안
- 폰 체크 및 앱 스캔 작업 글로벌하게 뒤에서 돌아가게끔 변경.  
- 보안 scan class 추가. 응집도 향상.  
- 탐지 다이얼로그 뜰 때만 main thread 사용.  
- 탐지 다이얼로그 뜬 후, 기타 비동기 작업 완료되어 화면 전환 등의 작업이 일어날 경우에도 앱 사용 막을 수 있도록 base activity 쪽에 탐지되었는지 체크 추가.  

### 효과
- splash 화면 속도 8초에서 2초로 개선. (당연히 폰 사정에 따라 달라짐)